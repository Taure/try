%% -*- mode: erlang;erlang-indent-level: 4;indent-tabs-mode: nil -*-

{erl_opts, [debug_info]}.
{src_dirs, ["src", "src/controllers"]}.
{shell, [{config, "./config/sys.config"}]}.

{erlydtl_opts, [{doc_root, "src/views"},
                {recursive, true},
                {libraries, [
                             {nova_erlydtl_inventory, nova_erlydtl_inventory}
                            ]},
                {default_libraries, [nova_erlydtl_inventory]}
               ]}.

{deps, [
   {lfe, {git, "https://github.com/rvirding/lfe", {branch, "develop"}}},
   {logjam, ".*", {git, "https://github.com/lfex/logjam.git", {branch, "master"}}},
   nova
  ]}.


%% Plugins for rebar3
{plugins, [
           {rebar3_lfe, {git, "http://github.com/lfe-rebar3/rebar3_lfe", {branch, "release/0.3.x"}}},
           {rebar3_nova_serve, {git, "https://github.com/novaframework/rebar3-nova-serve.git", {branch, "master"}}},
           {rebar3_erlydtl_plugin, ".*",
            {git, "https://github.com/tsloughter/rebar3_erlydtl_plugin.git", {branch, "master"}}}
          ]}.

{provider_hooks, [
    {pre, [{compile, 'make-routes'},
           {compile, {erlydtl, compile}},
           {compile, {lfe, compile}}]}
]}.

{alias, [
    {'make-routes', [
        {lfe, confabulate, "--path=priv/*routes.lfe"}]}
]}.

{relx, [{release, {'trylfe', "0.1.0"},
         [sasl,
          lfe,
          logjam,
          'trylfe']},

        {sys_config, "./config/sys.config"},
        {vm_args, "./config/vm.args"},

        {dev_mode, true},
        {include_erts, false},

        {extended_start_script, true}]
}.